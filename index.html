<textarea id="messages" rows="32" cols="100"></textarea><br><br>
<input id="user" placeholder="Username"></input>
<input id="msg" placeholder="Message"></input>
<button onclick="sendMessage()">Send</button>

<script src="/socket.io/socket.io.js"></script>
<script>
  let messageHistory = []
  let socket = io()
 
  Notification.requestPermission()
  
  function notify(msg) {
    let notification = new Notification(msg.name + " says:", {
      body: msg.message
    })
  }

  function sendMessage() {
    let userName = document.getElementById("user").value
    let message = document.getElementById("msg").value
    socket.emit("new_client_msg", { name: userName || "Anonymous", message: message || "has nothing to say" })
  }

  socket.on("recent_messages", (messages) => {
    messageHistory = messages
    displayMessages()
  })

  socket.on("new_msg", msg => {
    messageHistory.push(msg)
    displayMessages()
    notify(msg)
  })

  function displayMessages() {
    let history = messageHistory.slice(-30).map(msg => `${msg.name}: ${msg.message}`).join("\n")
    document.getElementById("messages").value = history
  }

</script>
